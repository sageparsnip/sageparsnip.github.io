<html>
	<head>
		<title>Sage Parsnip's Home Page </title>
		<link rel="stylesheet" href="./bootstrap.css">
		<script src="./jquery-3.6.3.min.js" type="text/javascript"></script>
		<link rel="icon" type="image/x-icon" href="assets/favicon.ico">
		<style>
			.container{
				width: 80%;
				padding-top: 1rem;
			}
		</style>
	</head>
	<body class="bg-dark text-light">
		<button onclick="previousLine()" style="position:fixed;top: 14rem; left:2rem">Previous Line</button>	
		<button onclick="nextLine()" style="position:fixed;top: 18rem; left:2rem">Next Line</button>
		<div class="container align-items-center">
			<h3>Learn Your Lines!</h3>
			<select id="script-select" onclick="loadScene()"></select>
			<div class="container" id="lineContainer">
				<div class="row">
					<div class="col-3"><b>Speaker:</b></div>
					<div class="col-9"><b>Line:</b></div>
				</div>
			</div>
			<script>
				let lineNo = 0;
				let i=0,found=0;
				let flip=false;
				let speaking = false;
				onload = (event) => {
					$.getJSON("scripts.json", function(json) {
						json.Scenes.forEach(scene => {
							document.getElementById("script-select").insertAdjacentHTML("beforeend", `<option value="${scene["Scene"]}">${scene["Scene"]}</option>`);
						});
					})
				}
				function nextLine(){
					//console.log("LineNo: " + lineNo + ", speaking: " + speaking);
					$.getJSON("scripts.json", function(json) {
						if(json.Scenes[i].Lines[lineNo].Speaker.length == 0){
							//Previous speaker continuing; print as normal
							document.getElementById("lineContainer").insertAdjacentHTML("beforeend", `
								<div class="row">
									<div class="col-3"><b>${json.Scenes[i].Lines[lineNo].Speaker}</b></div>
									<div class="col-9">${json.Scenes[i].Lines[lineNo].Line}</div>
								</div>
							`);
							lineNo++;
						}
						else{
							//Speaker has just changed; print the speaker's name if the flag is 0, line if 1
							if(speaking){
								speaking = false;
								//Speaker's name printed last run; print line, and increment LineNo
								document.getElementById("lineContainer").insertAdjacentHTML("beforeend", `
									<div class="row">
										<div class="col-3"></div>
										<div class="col-9">${json.Scenes[i].Lines[lineNo].Line}</div>
									</div>
								`);
								lineNo++;
							}
							else{
								speaking = true;
								//Just print the speaker's name
								document.getElementById("lineContainer").insertAdjacentHTML("beforeend", `
									<div class="row">
										<div class="col-3"><b>${json.Scenes[i].Lines[lineNo].Speaker}</b></div>
										<div class="col-9"></div>
									</div>
								`);
							}
						}
					});
				}

				function previousLine(){
					//find last row in the container and erase it.
					var container = document.getElementById("lineContainer");
					var lineDelete = container.childNodes[container.childNodes.length - 2];
					if(String(lineDelete.childNodes[1].innerHTML).length > 0)
						lineNo--;
					lineDelete.remove();
					var lineDelete = container.childNodes[container.childNodes.length - 2];
					lineDelete.remove();
					var lineDelete = container.childNodes[container.childNodes.length - 2];
					lineDelete.remove();
				}

				function loadScene(){
					lineNo = 0;
					var sceneName = document.getElementById("script-select").options[document.getElementById("script-select").selectedIndex].text;
					$.getJSON("scripts.json", function(json) {
						//Go to correct scene in JSON
						i=0;
						found=0;
						while(i < json.Scenes.length && found == 0){
							if(json.Scenes[i].Scene == sceneName){
								found=1;
							}
							else{
								i++;
							}
						}
						/**
						if(json.Scenes[i].Lines.length > 0){
							//Here we actually display all the text.
							json.Scenes[i].Lines.forEach(line => {
								document.getElementById("lineContainer").insertAdjacentHTML("beforeend", `
									<div class="row">
										<div class="col-3"><b>${line.Speaker}</b></div>
										<div class="col-9">${line.Line}</div>
									</div>
								`);
							});
						}
						**/
					})
				}
			</script>
			<hr>
		</div>
	</body>
</html>